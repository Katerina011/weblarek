https://github.com/Katerina011/weblarek.git
# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src\pages\index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

`Model` - слой данных, отвечает за хранение и изменение данных.  

`View` - слой представления, отвечает за отображение данных на странице.

`Presenter` - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

В данной работе презентер реализуется в index.ts без выделения в отдельный класс.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.
Реализует интерфейс IApi

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер 

`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  

`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.

`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  

`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Слой данные

#### Карточка товара - интерфейс IProduct
Для описания структуры товара.

    interface IProduct {
        id: string;
        description: string;
        image: string;
        title: string;
        category: string;
        price: number | null;
    }

#### Покупатель - интерфейс IBuyer

    interface IBuyer {
        payment: 'card' | 'cash' | '';
        email: string;
        phone: string;
        address: string;
    }



#### Класс CatalogModel
Отвечает за хранение и логику работы с каталогом товаров.\
Конструктор:\
    `constructor (events: IEvents)` 
инициализирует модель каталога товаров. При создании экземпляра инициализируется начальное состояния каталога. `events` -  обязательный параметр, содержащий систему событий, позволяет модели генерировать события при изменении данных.

Поля:
- `items: IProductData` - хранит данные о товарах в каталоге
- `events: IEvents` - экземпляр системы событий

Методы класса:

- `setItems(items: IProductData)` - устанавливает новые данные каталога и генерирует событие об обновлении `model:cards updated`.

- `getItems()` - для получения всех товаров из каталога.

- `getItem(id: string): IProduct` - для получения товара по идентификатору.

#### Класс CartModel
Содержит данные и логику работы корзины.\
Конструктор:

`constructor(protected events: IEvents) {}` инициализирует пустой массив товаров при создании экземпляра. `events` -  обязательный параметр, содержащий систему событий, позволяет модели генерировать события при изменении данных.\

Поле:
- `protected _items: IProduct[] = []` - хранит список товаров в корзине

Методы класса:
- `hasItem(id: string): boolean` - для проверки наличия товара в корзине по идентификатору, если товар находится в корзине возвращает true.

- `addItem(item: IProduct): void` - для добавления товара в корзину, если его еще нет в корзине. Если товар уже добавлен выдает ошибку. Генерирует событие для оповещения об изменении модели `model:cart change`
- `deleteItem(id: string): void` - метод для удаления товара из корзины по идентификатору.

- Геттер `items()`- для получения списка товаров в корзине.

- `getTotalItem(): number` - для подсчета общего количества товаров в корзине.

- `getTotalPrice(): number` - для расчета общей стоимости товаров в корзине.

- `clear(): void` - для очистки корзины. Генерирует событие `model:cart change`.

#### Класс BuyerModel
Отвечает за хранение и обработку данных о покупателе и и способе оплаты.\
Реализует интерфейс IBuyer

Конструктор:

`constructor(protected events: IEvents)` - при создании экземпляра поля пустые, `events` -  обязательный параметр, содержащий систему событий, позволяет модели генерировать события при изменении данных.

Поля:
 - `payment` - способ оплаты
 - `address` - адрес доставки
 - `email`- адрес электронной почты покупателя
 - `phone` - номер телефона покупателя

Методы:
 - Геттер `buyer():IBuyer` возвращает объект типа IBuyer с данными покупателя.

 - `protected fieldValue(field: keyof IBuyer, value: any)`- метод, содержащий логику обновления полей, принимает 2 аргумента: название поля для обновления и его значение. Генерирует событие `buyer:change` и передает название измененного поля.

 - Сеттеры `payment(value: 'card' | 'cash' | '')`, `address(value: string)`, `email(value: string)`, `phone(value: string)` используют метод `fieldValue()` и устанавливают значение для каждого поля соответственно.

 - `resetBuyer(): void` - метод для очистки всех полей,  использует метод `fieldValue()` для генерации событий для каждого поля.

 - `isValid(): Record<string, string>` - метод для валидации полей, проверяет заполнены ли поля payment, email, phone и address. Метод возвращает объект. Если поле не заполнено, добавляется соответствующая ошибка в объект.Если поле валидно, оно не включается в объект ошибок.

 ### Слой коммуникации
 #### Интерфейс для работы с API
    interface IApi {
        get<T extends object>(uri: string): Promise<T>;
        post<T extends object>(uri: string, data: object, method: ApiPostMethods): Promise<T>
    }
- `get` - метод для выполнения GET запроса
- `post` - метод для выполнения POST/PUT/DELETE запросов.
    
#### Интерфейс данных заказа
    interface IOrderData {
        items: (string | number)[];
        total: number;
        payment: 'card' | 'cash' | '';
        address: string;
        email: string;
        phone: string;
    }
Содержит данные для отправки сформированного заказа на сервер: массив выбранных товаров, информацию о покупателе, итоговую сумму.

#### Интерфейс ответа API

    interface IApiResponse {
        id: string;
        total: number;
    }
Описывает структуру ответа от сервера: статус код ответа и данные от сервера.
 #### Класс ProductApi 
 Класс для работы с API товаров. Хранит экземпляр базового API для выполнения HTTP-запросов

 Конструктор:\
 `constructor(baseApi: IApi) {
       this._baseApi = baseApi;
    }` - принимает экземпляр базового API для выполнения запросов.

 Методы:

 - `getProduct(): Promise<IProductData>` - получение списка товаров с сервера.
 - `postOrder(orderData: IOrderData): Promise<IApiResponse>` - метод для отправки данных заказа на сервер.

 ### Слой представления

 #### Класс Header
 Наследуется от абстрактного класса Component и реализует интерфейс `IHeader { counter: number}` counter - счетчик корзины.\
 Компонент отображения шапки сайта. Отвечает за отображение счетчика товаров в корзине и обработку клика по кнопке корзины.

 Конструктор:

 `constructor(protected events: IEvents, container: HTMLElement)` -принимает обязательный параметр `events`, содержащий систему событий и `container` - HTML-элемент, в котором размещается компонент.

 Собственные свойства:
 - `protected counterElement: HTMLElement` - элемент для отображения счетчика товаров,
 - `protected cartButton: HTMLButtonElement` - кнопка открытия корзины.
При клике на кнопку корзины генерируется событие для открытия корзины - `cart:open`

 Методы:

 - Сеттер `counter(value: number)` - устанавливает текст значения счетчика.

#### Класс GalleryView
Наследуется от абстрактного класса Component и реализует интерфейс `IGallery { galleryContainer: HTMLElement[]}`, где  galleryContainer -  массив элементов контейнера галереи.\
Данный класс отвечает за отображение и обновление каталога.

Конструктор:\
`constructor(container: HTMLElement)` - принимает контейнер для размещения компонента.

Свойства:

- `protected catalogElement: HTMLElement`- корневой элемент галереи.

Методы:

- Сеттер `galleryContainer(items: HTMLElement[])` - заменяет все дочерние элементы в корневом элементе галереи на переданный массив элеметов.


#### Компоненты отображения карточек товаров
Классы: 
- `CardBase`- базовый абстрактный класс для всех карточек
- `CardImageAndCategory`- абстрактный родительский класс для отображения карточек каталога и предпросмотра
- `CardCatalog`- класс для отображения карточек каталога
- `CardPrewiew`- класс для отображения карточек в предпросмотре
- `CardCart` - класс для отображения карточек в корзине.

#### Класс CardBase
Базовый абстрактный класс для создания всех карточек. Наследуется от базового абстрактного класса `Component`, тип данных карточки должен расширять интерфейс `IProduct`.

Конструктор:\
`constructor(container: HTMLElement)` - принимает контейнер для размещения компонента.

Свойства:

- `protected titleElement: HTMLElement`- элемент для отображения названия товара,
- `protected priceElement: HTMLElement` - элемент для отображения цены товара.
Эти свойства есть у всех вариантов отображения карточек товара и будут наследоваться их классами.

Методы:

- `protected setText(element: HTMLElement, value: unknown)` - метод для установки текстового содержимого элемента, принимает два аргумента: элемент и значение, которое преобразуется в строку, есть проверка существования элемента

- Сеттеры `title(value: string)`,  `price(value: number | null)` - для установления названия и цены товара в элементе, используют метод `setText()`.

#### Класс CardImageAndCategory
Наследуется от базового абстрактного класса `CardBase`, тип данных карточки должен расширять интерфейс `IProduct`.
Базовый  абстрактный класс, расширяющий функциональность карточек товаров добавлением отображения категории и изображения товаров.

Конструктор:

`constructor(container: HTMLElement)` - принимает контейнер для размещения компонента.

Свойства:
- `protected categoryElement: HTMLElement`- элемент для отображения категории товара,
- `protected imageElement: HTMLEImagelement` - элемент для отображения изображения товара.

Методы:

- Сеттер `category(value: keyof typeof categoryMap)`- устанавливает текст категории в соответствующий элемент,добавляет CSS-классы из categoryMap,

- Сеттер `image(value: string)` - формирует полный URL изображения с использованием `CDN_URL`, устанавливает изображение для элемента. Использует родительский метод `setImage`.

#### Класс CardCatalog
Наследуется от абстрактного класса `CardImageAndCategory`.
Расширяет функциональность родительского класса добавлением возможности обработки кликов по карточке.

Конструктор:\
`constructor(container: HTMLElement, actions?: IActions)` - принимает два параметра: обязательный параметр - контейнер для размещения компонента, опициональный параметр - объект с действиями для карточки, соответсвует интерфейсу `interface IActions {onClick: (event: MouseEvent) => void}`.\
При наличии обработчика клика в actions: добавляется обработчик события click к корневому элементу, используется функция onClick из объекта actions.

Свойства и методы: собственных свойств и методов нет, наследуется от `Component`, `CardBase`, `CardImageAndCategory`.

#### Класс CardPrewiew
Наследует функциональность абстрактного класса `CardImageAndCategory` и расширяет ее описанием товара и кнопкой добавления товара в корзину.\
Класс отвечает за отображение карточки в режиме предпросмотра

Конструктор:\
`constructor(container: HTMLElement, actions?: IActions)` - принимает два параметра: обязательный параметр - контейнер для размещения компонента, опициональный параметр - объект с действиями для карточки, соответсвует интерфейсу `interface IActions {onClick: (event: MouseEvent) => void}`.\
При наличии обработчика в actions: добавляется обработчик события click к кнопке добавления в корзину, используется функция onClick из объекта actions.

Свойства:
- `protected descriptionElement: HTMLElement`- элемент для отображения описания товара
- `protected btnAddToCart: HTMLButtonElement` - кнопка добавления товара в корзину.

Методы:
- Сеттер `description(value: string)`- устанавливает текстовое содержание элемента описания товара.

- `btnFree(): void` - метод блокирует кнопку добавления товара в корзину и установливает ей текст 'Недоступно'.

- `btnText(inCart: boolean)` -  метод устанавливает текстовое содержание кнопки добавления в корзину в зависимости от булевого значения передаваемого параметра: 'Удалить из корзины' - если товар в корзине, 'Купить' - если товара нет в корзине.


#### Класс CardCart
Наследуется от базового абстрактного класса `CardBase`.\
Класс отвечает за отображение карточек товара в корзине.

Конструктор:\
`constructor(container: HTMLElement, actions?: IActions)` - принимает два параметра: обязательный параметр - контейнер для размещения компонента, опициональный параметр - объект с действиями для карточки, соответсвует интерфейсу `interface IActions {onClick: (event: MouseEvent) => void}`.\
При наличии обработчика в actions: добавляется обработчик события click к кнопке удаления товара из корзины, используется функция onClick из объекта actions.

Свойства:
- `protected indexElement: HTMLElement` - элемент для отображения порядкового номера товара в корзине.
- `protected btnDelete: HTMLButtonElement` - кнопка удаления товара из корзины.
- `protected _index:number = 0`- порядковый номер (значение по умолчанию 0).

Методы:
- Сеттер `index(_index: number)` устанавливает текстовое содержание индекса элемента с увеличением значения на 1.

- `render(data: IProduct & { index?: number }): HTMLElement` - вызывает базовый метод render, устанавливает индекс, если он передан, и возвращает контейнер.


#### Класс CartView
Класс отвечает за отображение корзины товаров. Наследуется от базового абстрактного класса `Component` и реализует интерфейс для управления содержимым корзины.

    interface ICart {
       total: number | string;
        items: HTMLElement[];
    }

Конструктор:\
`constructor (protected events: IEvents, container: HTMLElement)` - принимает два параметра: объект для обработки событий и контейнер для размещения элемента корзины.\
При клике на кнопку оформления заказа генерируется событие для открытия формы заказа `cart:order`

Свойства:
- `contentList: HTMLUListElement` — список товаров в корзине

- `totalPrice: HTMLElement` — элемент для отображения общей стоимости товаров

- `btnOrder: HTMLButtonElement` — кнопка оформления заказа

- `items: HTMLElement[]` — массив товаров в корзине.

Методы:
 - Сеттер `total (value: number)`- установление текстового содержания для элемента отображения общей стоимости товаров

 - Сеттер `items (items: HTMLElement[])` - обновляет содержимое списка товаров, если массив товаров пустой, устанавливается текстовое содержимое для списка 'Корзина пуста'

 - ` btnDisabled(total: number)`- метод деактивации кнопки заказа в зависимости от суммы корзины, если итоговая сумма равна нулю - кнопка неактивна, если нет - кнопка активна.

#### Класс FormComponent
Абстрактный базовый класс для создания форм.Наследуется от базового абстрактного класса `Component и реализует интерфейс

    interface IForm {
        valid: boolean;
        error: string;
    }
Конструктор:\
`constructor(events: IEvents, container: HTMLFormElement)` - принимает два параметра объект событий и контейнер формы.

Свойства:
- `_btnSubmit: HTMLButtonElement` — кнопка для отправки формы

- `errorsContainer: HTMLElement` — контейнер для отображения ошибок\

Обработчик ввода `input` отслеживает любые изменения в полях ввода формы. С использованием вспомогательного метода inputChange генерирует событие изменения поля ввода: `${this.container.getAttribute('name')}.${String(field)}:change`

Обработчик отправки `submit` блокирует стандартное поведение через preventDefault(), генерирует событие отправки формы с именем формы: `${this.container.getAttribute('name')}:submit`

Методы:
- `inputChange(field: keyof T, value: string)` - генерирует событие изменения поля и передает измененное поле и его значение

- Сеттер `valid(value: boolean)` - управляет доступностью кнопки отправки. Деактивация кнопки, если форма не валидна и наоборот

- Сеттер `error`- устанавливает текстовое содержимое контейнера с ошибками.

#### Класс OrderForm
Класс отвечает за форму оформления заказа.\
Наследует функциональность от FormComponent и добавляет функционал для выбора способа оплаты и адреса доставки. Реализует тип type `TOrderFormValues = Pick<IBuyer, 'payment' | 'address'>`

Конструктор\
`constructor(protected events: IEvents, container: HTMLFormElement)` принимает 2 параметра: объект событий и контейнер формы.\
Содержит обработчики клика на кнопки оплаты: при клике на кнопку с именем сard генерируется событие `'order:payment'` и передается метод оплаты `'card'`.
При клике на кнопку cash генерируется событие `'order:payment'` с методом `'cash'`.

Свойства:
- ` protected btnCard: HTMLButtonElement` - кнопка выбора оплаты онлайн, картой
- `protected btnCash: HTMLButtonElement` - кнопка выбора оплаты наличными
- ` protected addressInput: HTMLInputElement` - поле ввода адреса.

Методы:
- Сеттер `payment(method: 'card' | 'cash' | '')` - устанавливает способ оплаты, управляет классами состояния кнопки для выделения активной кнопки.

- Геттер `payment(): 'card' | 'cash' | '' ` - проверяет классы кнопок для определения выбранного способа и возвращает текущий выбранный способ оплаты

- Сеттер `address(value: string)` - устанавливает значение поля ввода адреса

#### Класс ContactsForm
Класс отвечает за форму оформления заказа с контактными данными покупателя.\
Наследует функциональность от FormComponent и добавляет функционал для указания контактной информации: адреса электронной почти и телефона. Реализует тип `type TContactsFormValues = Pick<IBuyer, 'email' | 'phone'>`

Конструктор\
`сonstructor(events: IEvents, container: HTMLFormElement)` принимает 2 параметра: объект событий и контейнер формы.

Свойства:
- `protected emailInput: HTMLInputElement` - поле ввода адреса электронной почты
- `protected phoneInput: HTMLInputElement` - поле ввода телефона.

Методы:
- Сеттер `phone(value: string)` - устанавливает значение поля ввода адреса электронной почты
- Сеттер `email(value: string)` - устанавливает значение поля ввода телефона.


#### Класс Modal
Отвечает за реализацию модального окна. Наследует базовую функциональность от Component и добавляет функционал для управления модальным окном.

Конструктор\
`constructor(protected events: IEvents, container: HTMLElement)` - принимает 2 параметра: объект событий и контейнер модального окна.\
Содержит обработчики клика на кнопку закрытия, на контейнер окна и его содержимое. Модальное окно закрывается  при клике на кнопку закрытия, клик внеобласти содержимого, нажатие кнопки Escape.

Свойства:
- `protected _content: HTMLElement` - контейнер для содержимого модального окна
- `protected btnClose: HTMLButtonElement` - кнопка закрытия модального окна
- `protected isOpen: boolean = false` - флаг состояния открытия
- `protected activeClass = 'modal_active'` - класс для активации окна.

Методы:
- ` open(content: HTMLElement): void` - метод отвечает за открытие модального окна, принимает содержимое модального окна, заменяет текущее содержимое, добавляет класс для активации, подписывается на клавишу Escape, устанавливает флаг состояния открытия true и генерирует событие `modal:open`.

- `close(): void` - реализация закрытия модального окна. Метод очищает содержимое, удаляет класс активации, отписывается от клавиши Escape, станавливает флаг isOpen в false и генерирует событие `modal:close`

- `handleClick(evt: MouseEvent): void` - вспомогательный метод для обработчика клика по контейнеру модального окна, проверяет, является ли целью клика сам контейнер модального окна, если условие истинно — вызывает метод close(), но не реагирует на клик по содержимому. Реализация закрытия по затемнению, клику вне области содержимого.

- `escape (evt: KeyboardEvent): void ` - проверяет нажатую клавишу Escape, при нажатии вызывается метод закрытия модального окна `close()`.

#### Класс Success
Отвечает за окно успешного завершения заказа. Наследует базовую функциональность от `Component` и предоставляет интерфейс для отображения сообщения об успешной операции.

    interface ISuccess {
        message: string;
        btnClose: HTMLButtonElement;
    }

Конструктор\
`constructor(protected events: IEvents, container: HTMLElement)` - принимает 2 параметра: объект событий и контейнер окна завершения заказа.\
Содержит обработчик клика на кнопку закрытия окна с генерацией события `'success:close` 

Свойства:
- `protected _description: HTMLElement` - элемент для размещения сообщения.
- `protected btnClose: HTMLButtonElement`- кнопка закрытия окна

Методы:
- Сеттер `message(value: number)` - формирует и устанавливает текст сообщения об операции. Принимает `value` — количество списанных синапсов.

